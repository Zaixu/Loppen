<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ngmodule_controllers.js - Loppen</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..\(Logo)LoppenV2.png" title="Loppen"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.8.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/(MOCK)FleaServices.html">(MOCK)FleaServices</a></li>
            
                <li><a href="../classes/AppModule.html">AppModule</a></li>
            
                <li><a href="../classes/Auth.html">Auth</a></li>
            
                <li><a href="../classes/FleaDirectives.html">FleaDirectives</a></li>
            
                <li><a href="../classes/FleaFilters.html">FleaFilters</a></li>
            
                <li><a href="../classes/FleamarketListCtrl.html">FleamarketListCtrl</a></li>
            
                <li><a href="../classes/FleaServices.html">FleaServices</a></li>
            
                <li><a href="../classes/GeocoderWrapper.html">GeocoderWrapper</a></li>
            
                <li><a href="../classes/HelloWorld.html">HelloWorld</a></li>
            
                <li><a href="../classes/LanguageModule.html">LanguageModule</a></li>
            
                <li><a href="../classes/MapWrapper.html">MapWrapper</a></li>
            
                <li><a href="../classes/NavigationMenu.html">NavigationMenu</a></li>
            
                <li><a href="../classes/Navigationmenu.html">Navigationmenu</a></li>
            
                <li><a href="../classes/NavigationModule.html">NavigationModule</a></li>
            
                <li><a href="../classes/RestModule.html">RestModule</a></li>
            
                <li><a href="../classes/ValidatorModule.html">ValidatorModule</a></li>
            
                <li><a href="../classes/ViewFleamarketInfo.html">ViewFleamarketInfo</a></li>
            
                <li><a href="../classes/ViewLandingPage.html">ViewLandingPage</a></li>
            
                <li><a href="../classes/ViewMarketMap.html">ViewMarketMap</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Bootstrappers.html">Bootstrappers</a></li>
            
                <li><a href="../modules/Directives.html">Directives</a></li>
            
                <li><a href="../modules/Services.html">Services</a></li>
            
                <li><a href="../modules/Tests.html">Tests</a></li>
            
                <li><a href="../modules/ViewModels.html">ViewModels</a></li>
            
                <li><a href="../modules/WebsiteServices.html">WebsiteServices</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ngmodule_controllers.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/* Should only be loaded with RequireJS. */
/**
 *  For fleamarket list page.
 *  @class FleamarketListCtrl
 *  @module ViewModels
 */

define([&quot;angular&quot;, &quot;language_module&quot;], function(angular, language)
{
    &#x27;use strict&#x27;;
    // Setup
    var module = angular.module(&quot;FleamarketControllers&quot;, [&quot;FleaServices&quot;]);
    
    module.controller(&quot;FleamarketListCtrl&quot;, [&quot;$scope&quot;, &quot;RESTFleamarkets&quot;, function($scope, RESTFleamarkets)
        {
            // Model data
            // :Labels and headers
            $scope.headerName = language.getString(&quot;marketlist_table_header_name&quot;);
            $scope.headerCity = language.getString(&quot;marketlist_table_header_city&quot;);
            $scope.labelSearch = language.getString(&quot;marketlist_search_text&quot;);
            $scope.headerMarkets = language.getString(&quot;marketlist_title&quot;);
            $scope.headerCategory = language.getString(&quot;marketlist_category_header&quot;);
            $scope.labelLoadingTitle = language.getString(&quot;marketlist_loading_title&quot;);
            $scope.labelLoadingMessage = language.getString(&quot;marketlist_loading_message&quot;);
            $scope.loadingText = language.getString(&quot;marketmap_spinnertext&quot;);
            
            // :Category selection
            /**
             *  Categories available to sort by.  
             *
             *  @property categories
             */
            $scope.categories =
            [
                {label: language.getString(&quot;marketlist_category_all&quot;), value: &quot;all&quot;},
                {label: language.getString(&quot;marketlist_category_trunk&quot;), value: &quot;trunk&quot;},
                {label: language.getString(&quot;marketlist_category_flea&quot;), value: &quot;flea&quot;},
                {label: language.getString(&quot;marketlist_category_charity&quot;), value: &quot;charity&quot;},
                {label: language.getString(&quot;marketlist_category_other&quot;), value: &quot;other&quot;}
            ];
            $scope.categorySelected = &quot;all&quot;; // Default value
            
            // :Item selection
            /**
             *  Item categories available to sort by.  
             *
             *  @property itemsAvailable
             */
            $scope.itemsAvailable =
                [
                    {label: language.getString(&quot;marketlist_item_clothes&quot;), value: &quot;clothes&quot;},
                    {label: language.getString(&quot;marketlist_item_furniture&quot;), value: &quot;furniture&quot;},
                    {label: language.getString(&quot;marketlist_item_antic&quot;), value: &quot;antic&quot;},
                    {label: language.getString(&quot;marketlist_item_other&quot;), value: &quot;other&quot;}
                ];
            $scope.itemsSelected = [&quot;clothes&quot;, &quot;furniture&quot;, &quot;antic&quot;, &quot;other&quot;]; // All selected to begin with
            
            // :Free search
            $scope.searchText = &quot;&quot;;
            
            // :Raw data
            $scope.fleamarketsLoaded = false;
            /**
             *  The flea markets and their data.
             *
             *  @property fleamarkets
             */
            $scope.fleamarkets = RESTFleamarkets.get({}, function(data)
            {
                // Check data
                if(data.status)
                {
                    // Set data
                    $scope.fleamarkets = data.result;
                    $scope.fleamarketsLoaded = true;
                }
                else
                {
                    alert(language.getErrorString(data.error));
                    $scope.fleamarketsLoaded = true;
                }
            }, function(error)
            {
                alert(language.getString(&quot;marketlist_server_error_defaultmsg&quot;));
                $scope.fleamarketsLoaded = true;
            });

            /**
             *  Helper function: Checks for the flea market or the name of its city contains the search string.
             *
             *  For filtering fleamarket on category, items and text in searchbox.
             *
             *  Can&#x27;t use &#x27;just&#x27; normal filtering since have special case &quot;all&quot;.
             *  @method _nameOrCityContainsString
             *  @param {Object} fleamarket Fleamarket to investigate.
             *  @param {String} searchText Text to search by.
             */
            function _nameOrCityContainsString(fleamarket, searchText)
            {
                searchText = searchText.toLowerCase();
                if(fleamarket.name.toLowerCase().indexOf(searchText) !== -1 || fleamarket.fleamarket_addresses.city.toLowerCase().indexOf(searchText) !== -1)
                {
                    return true;
                }
                return false;
            }
            // 
            /**
             *  Helper function: Checks for the flea market contains atleast one of the items selected.
             *  @method _containsItems
             *  @param {Object} fleamarket Fleamarket to check.
             *  @private
             */
            function _containsItems(fleamarket)
            {
                for(var i = 0; i &lt; fleamarket.fleamarket_items.length; i++)
                {
                    if($scope.itemsSelected.indexOf(fleamarket.fleamarket_items[i].name) &gt; -1)
                        return true;
                } 
                return false;
            }
            /**
             *  Checks that a flea market should be shown according to filtering.
             *  @method shouldShow
             *  @param {Object} fleamarket Fleamarket to show.
             */
            $scope.shouldShow = function(fleamarket)
            {
                // Category
                if($scope.categorySelected == &quot;all&quot; || fleamarket.category == $scope.categorySelected)  // NOTE: In production version should get from language library.
                {
                    // Search
                    if(_nameOrCityContainsString(fleamarket, $scope.searchText))
                    {
                        if(_containsItems(fleamarket))
                            return true;
                    }
                }
                
                return false;
            };

            /**
             *  Function when list is being pushed/clicked - Navigate to info page.
             * 
             *  @method showFleamarketInfo
             *  @parram id Id of fleamarket.
             *  @param shouldNotChangePage Is used for unit testing where page change is not desired.
             */
            $scope.showFleamarketInfo = function(id, shouldNotChangePage)
            {
                shouldNotChangePage = typeof shouldNotChangePage == &#x27;undefined&#x27; ?  false : shouldNotChangePage;
                localStorage.setItem(&quot;fleamarket_id&quot;, id);

                if(!shouldNotChangePage)
                    window.location.href = &quot;fleamarket_info.html&quot;;
            };

            /**
             *  Item category selection.
             *  @method itemSelect
             *  @param item Item that is selected.
             */
            $scope.itemSelect = function(item)
            {
                var indexOfItem = $scope.itemsSelected.indexOf(item.value);
                if(indexOfItem &gt; -1)
                    $scope.itemsSelected.splice(indexOfItem, 1);
                else
                    $scope.itemsSelected.push(item.value);
            };
        }]); 
    
    console.log(&quot;NG: Controllers loaded.&quot;);
    return module;
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
